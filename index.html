<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è‹±è¯­æ™ºèƒ½èƒŒè¯æ‰“å¡å¹³å°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial, sans-serif;
  padding:20px;
  max-width:900px;
  margin:auto;
}
button,input,select{
  padding:10px;
  margin:6px;
  font-size:16px;
}
.word{
  font-size:28px;
  font-weight:bold;
  color:#2c3e50;
  cursor:pointer;
}
.example{
  color:#555;
  margin-top:5px;
}
.card{
  border:1px solid #ddd;
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}
.info{
  color:#666;
  margin-top:10px;
}
.record-item{
  cursor:pointer;
  color:#3498db;
  margin:6px 0;
}
.record-item:hover{
  text-decoration:underline;
}
</style>
</head>
<body>

<h1>ğŸ“– è‹±è¯­æ™ºèƒ½èƒŒè¯æ‰“å¡å¹³å°</h1>

<label>æ¯æ—¥å•è¯æ•°ï¼š</label>
<input type="number" id="dailyCount" value="10" min="1">

<label>é¡ºåºï¼š</label>
<select id="orderMode">
  <option value="fixed">å›ºå®šé¡ºåº</option>
  <option value="random">éšæœºé¡ºåº</option>
</select>

<br><br>
<button onclick="start()">å¼€å§‹ä»Šæ—¥æ‰“å¡</button>

<div id="card" class="card"></div>
<div id="progress" class="info"></div>
<div id="record" class="info"></div>

<script>
/* ===============================
   åŸºç¡€é…ç½®
================================ */
const WORD_URL =
  "https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt";
const CACHE_KEY = "WORD_CACHE_V1";
const RECORD_KEY = "PUNCH_RECORD";

let words = [];
let todayList = [];
let index = 0;

/* ===============================
   åŠ è½½è¯åº“
================================ */
async function loadWords(){
  if(localStorage.getItem(CACHE_KEY)){
    words = JSON.parse(localStorage.getItem(CACHE_KEY));
    return;
  }
  const res = await fetch(WORD_URL);
  const txt = await res.text();
  words = txt.split("\n").filter(w=>w.trim()).map(w=>({w}));
  localStorage.setItem(CACHE_KEY, JSON.stringify(words));
}
loadWords();

/* ===============================
   å¼€å§‹æ‰“å¡
================================ */
function start(){
  const n = parseInt(dailyCount.value);
  let pool = [...words];
  if(orderMode.value==="random") pool.sort(()=>Math.random()-0.5);

  todayList = pool.slice(0,n);
  index = 0;
  showWord();
}

/* ===============================
   æ˜¾ç¤ºå•è¯
================================ */
function showWord(){
  if(index >= todayList.length){
    completePunch();
    return;
  }
  const w = todayList[index].w;
  card.innerHTML = `
    <div class="word">${w}</div>
    <button onclick="nextWord()">ä¸‹ä¸€ä¸ª</button>
  `;
  progress.innerText = `è¿›åº¦ï¼š${index+1} / ${todayList.length}`;
}

function nextWord(){
  index++;
  showWord();
}

/* ===============================
   æ‰“å¡å®Œæˆï¼ˆâ­ æ ¸å¿ƒè”åŠ¨é€»è¾‘ï¼‰
================================ */
function completePunch(){
  const date = new Date().toLocaleDateString();
  const rec = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");

  const wordsToday = todayList.map(w=>w.w);

  rec.push({
    date,
    count: wordsToday.length,
    words: wordsToday
  });

  localStorage.setItem(RECORD_KEY, JSON.stringify(rec));

  /* â­ å‘Šè¯‰åœ£è¯æ ‘ï¼šçœ‹â€œæœ€æ–°è¿™ä¸€å¤©â€ */
  localStorage.setItem("TREE_RECORD_INDEX", rec.length - 1);

  card.innerHTML = "ğŸ‰ ä»Šæ—¥æ‰“å¡å®Œæˆï¼";
  progress.innerText = `ä»Šæ—¥å­¦ä¹  ${wordsToday.length} ä¸ªå•è¯`;
  showRecord();
}

/* ===============================
   æ˜¾ç¤ºæ‰“å¡è®°å½•ï¼ˆç‚¹å‡»è¿›å…¥åœ£è¯æ ‘ï¼‰
================================ */
function showRecord(){
  const rec = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
  if(!rec.length){
    record.innerHTML = "æš‚æ— æ‰“å¡è®°å½•";
    return;
  }

  let html = "ğŸ“ æ‰“å¡è®°å½•ï¼ˆç‚¹å‡»è¿›å…¥åœ£è¯æ ‘ï¼‰ï¼š<br>";
  rec.slice().reverse().forEach((r,i)=>{
    const realIndex = rec.length - 1 - i;
    html += `
      <div class="record-item"
           onclick="openTree(${realIndex})">
        ğŸ„ ${r.date}ï¼ˆ${r.count} è¯ï¼‰
      </div>
    `;
  });
  record.innerHTML = html;
}

/* ===============================
   è·³è½¬åœ£è¯æ ‘
================================ */
function openTree(i){
  localStorage.setItem("TREE_RECORD_INDEX", i);
  window.location.href = "tree.html";
}

/* åˆå§‹åŒ–è®°å½• */
showRecord();
</script>

</body>
</html>
